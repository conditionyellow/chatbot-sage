# Gemini Chatbot with Live2D (Natori Edition) - 統合起動システム

Live2Dキャラクター「Natori」を使用したGemini APIチャットボットに、YouTubeライブチャット統合機能とシンプルな統合起動システムを実装した完全版システムです。

## 最新の更新 (v3.1.0) - 統合起動システム 🚀

### 🎯 シンプル統合起動
- **ワンコマンド起動**: `npm start`で全サーバーが連動起動
- **統合停止**: `npm stop`で全プロセスを安全に停止
- **開発モード**: `npm run dev`でファイル監視付き起動
- **プロセス管理**: PIDファイルによる確実なプロセス管理

### 🔧 自動化機能
- **依存関係チェック**: 初回起動時の自動`npm install`
- **ポート競合解決**: 既存プロセスの自動停止・再起動
- **起動確認**: 各サーバーの正常起動チェック
- **ログ管理**: 分離されたログファイル管理

### 🛡️ 安全性向上
- **段階的停止**: SIGTERM → SIGKILL による安全な停止
- **プロセス監視**: 異常終了時の自動対応
- **ファイルクリーンアップ**: 一時ファイルの自動削除

## 🚀 クイックスタート（新方式）

### 統合起動（推奨）
```bash
# 全サーバーを一度に起動
npm start

# 開発モード（ファイル監視付き）
npm run dev
```

### 統合停止
```bash
# 全サーバーを安全に停止
npm stop

# または起動中のターミナルで Ctrl+C
```

### アクセス
起動完了後、以下のURLにアクセス：
- **チャットボット**: http://localhost:8080
- **管理画面**: http://localhost:8081 (admin / chloe2025)
- **バックエンドAPI**: http://localhost:3001

## アーキテクチャ構成

```
┌─────────────────┐    ┌──────────────────┐    ┌─────────────────┐
│  Public Client  │    │   Backend API    │    │  Admin Panel    │
│  (Frontend)     │    │   (Server)       │    │  (Management)   │
│ localhost:8080  │◄──►│ localhost:3001   │◄──►│ localhost:8081  │
└─────────────────┘    └──────────────────┘    └─────────────────┘
         │                        │                        │
         └───────────► Gemini API ◄────────────────────────┘
                            │
                   YouTube Data API v3
```

## セキュリティアーキテクチャ分離 🔒
- **3層アーキテクチャ**: フロントエンド、バックエンドAPI、管理画面の完全分離
- **APIキーセキュリティ**: フロントエンドからAPIキー情報を完全削除
- **認証システム**: bcryptハッシュによる安全な管理画面認証
- **セッション管理**: Express.jsベースのセキュアな認証システム

## YouTubeライブチャット完全統合 📺
- **リアルタイム監視**: YouTube Data API v3による継続的チャット監視
- **自動メッセージ取得**: ライブチャットメッセージの自動取得・配信
- **統合UI**: フロントエンドでのYouTubeメッセージ自動表示
- **自動応答**: YouTubeコメントに対するNatoriの自動応答
- **管理機能**: 包括的な管理画面での監視制御

## 従来の起動方法（手動）

### 1. バックエンドAPI起動
```bash
cd server
npm install
npm start
# → localhost:3001で起動
```

### 2. フロントエンド起動
```bash
cd public
python3 -m http.server 8080
# → localhost:8080で起動
```

### 3. 管理画面起動
```bash
cd admin
python3 -m http.server 8081
# → localhost:8081で起動
```

### 4. 管理画面設定
1. http://localhost:8081 にアクセス
2. ログイン（admin / chloe2025）
3. YouTube設定でAPIキーと動画IDを設定
4. 監視開始

## 主要機能

### チャットボット機能
- **Natori性格システム**: 一貫したキャラクター性を持つ対話
- **Live2D表情制御**: 感情分析による自動表情変更
- **マルチ音声エンジン**: AivisSpeech、Web Speech API、Google Cloud TTS
- **リップシンク**: 音声に同期した高精度口パク

### YouTube統合機能
- **ライブチャット監視**: リアルタイムメッセージ取得
- **自動応答**: YouTubeコメントへの自動返答
- **統合表示**: YouTubeメッセージの専用UI表示
- **管理制御**: 包括的な監視制御システム

### セキュリティ機能
- **認証保護**: 管理画面のセッション認証
- **ファイル隠蔽**: admin.html → index.html による推測攻撃防止
- **ディレクトリ保護**: 直接アクセスでの管理画面表示
- **APIキー分離**: フロントエンドでのAPIキー露出防止
- **レート制限**: API濫用防止
- **ログ監視**: 全操作の記録・監視

## ファイル構成

```
chatbot_sage/
├── public/          # フロントエンド（公開クライアント）
├── server/          # バックエンドAPI（セキュアサーバー）
├── admin/           # 管理パネル（認証保護）
├── docs/            # ドキュメント
├── dev-tools/       # 開発・テスト用ツール
├── legacy-files/    # 旧ファイル（後方互換性）
└── models/          # Live2Dモデル
```

## ドキュメント

- **[技術仕様書](docs/SPECIFICATION.md)**: 詳細な技術仕様
- **[YouTube API設定](docs/YOUTUBE_API_SETUP.md)**: YouTube API設定ガイド
- **[アーキテクチャ分離計画](docs/ARCHITECTURE_SEPARATION_PLAN.md)**: システム設計文書
- **[管理画面セキュリティ強化](docs/ADMIN_SECURITY_ENHANCEMENT.md)**: セキュリティ改善実装レポート

## 変更履歴

- **v3.0.0** (2025/6/11): セキュリティアーキテクチャ分離、YouTubeライブチャット完全統合、管理画面セキュリティ強化
- **v2.4.0** (2025/6/8): Natori性格システム完全実装
- **v2.3.0** (2025/6/8): プロジェクト整理・最適化、リップシンク機能強化
- **v2.2.0** (2025/6/7): 感情表現制御システム改善
- **v2.1.0** (2025/6/7): 感情ベースモーション制御システム追加
- **v2.0.0** (2025/6/2): Live2D統合とマルチ音声エンジン対応
