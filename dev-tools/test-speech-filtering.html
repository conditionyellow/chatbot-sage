<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>音声フィルタリング機能テスト</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-case {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
        }
        .passed {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
        }
        .failed {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
        }
        .test-input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🎯 音声フィルタリング機能テスト</h1>
        <p>このページでは、チャットボットの音声読み上げから「*」とURLを除外する機能をテストします。</p>
        
        <h2>📋 自動テスト結果</h2>
        <div id="testResults"></div>
        
        <h2>🧪 手動テスト</h2>
        <p>以下にテストしたいテキストを入力してください：</p>
        <input type="text" id="manualTestInput" class="test-input" 
               placeholder="例: *重要* https://example.com をチェック！😊"
               value="*重要* https://example.com をチェック！😊">
        <br>
        <button onclick="runManualTest()">フィルタリングテスト</button>
        <div id="manualTestResult" class="result" style="display:none;"></div>
        
        <h2>🎵 実際の音声テスト</h2>
        <p>実際に音声読み上げをテストしてみましょう：</p>
        <input type="text" id="speechTestInput" class="test-input" 
               placeholder="音声テスト用テキスト"
               value="*こんにちは* 私はChloeです！ https://github.com を参照してください😊">
        <br>
        <button onclick="testSpeech()">音声読み上げテスト</button>
        <div id="speechTestResult" class="result" style="display:none;"></div>
    </div>

    <script>
        // テスト用のremoveEmojis関数（メインのscript.jsと同じ実装）
        function removeEmojis(text) {
            const emojiRegex = /[\u{1F600}-\u{1F64F}]|[\u{1F300}-\u{1F5FF}]|[\u{1F680}-\u{1F6FF}]|[\u{1F1E0}-\u{1F1FF}]|[\u{2600}-\u{26FF}]|[\u{2700}-\u{27BF}]|[\u{1F900}-\u{1F9FF}]|[\u{1F018}-\u{1F270}]|[\u{238C}]|[\u{2194}-\u{2199}]|[\u{21A9}-\u{21AA}]|[\u{2934}-\u{2935}]|[\u{23CF}]|[\u{23E9}-\u{23F3}]|[\u{23F8}-\u{23FA}]|[\u{25AA}-\u{25AB}]|[\u{25B6}]|[\u{25C0}]|[\u{25FB}-\u{25FE}]|[\u{2B50}]|[\u{2B55}]|[\u{3030}]|[\u{303D}]|[\u{3297}]|[\u{3299}]/gu;
            
            const urlRegex = /https?:\/\/[^\s]+|www\.[^\s]+|[a-zA-Z0-9][a-zA-Z0-9-]*[a-zA-Z0-9]*\.([a-zA-Z]{2,})(\/[^\s]*)?/gi;
            
            const asteriskRegex = /\*/g;
            
            let cleanText = text;
            cleanText = cleanText.replace(emojiRegex, '');
            cleanText = cleanText.replace(urlRegex, '');
            cleanText = cleanText.replace(asteriskRegex, '');
            cleanText = cleanText.replace(/\s+/g, ' ').trim();
            
            return cleanText;
        }

        // テストケース
        const testCases = [
            {
                name: 'アスタリスク除去テスト',
                input: 'こんにちは！* これは重要な*メッセージです。*',
                expected: 'こんにちは！ これは重要なメッセージです。'
            },
            {
                name: 'URL除去テスト（https）',
                input: 'こちらのサイトをチェック: https://www.example.com をご覧ください。',
                expected: 'こちらのサイトをチェック: をご覧ください。'
            },
            {
                name: 'URL除去テスト（www）',
                input: '詳細は www.google.com で確認できます。',
                expected: '詳細は で確認できます。'
            },
            {
                name: 'URL除去テスト（ドメイン形式）',
                input: 'example.com と test.org を参照してください。',
                expected: 'と を参照してください。'
            },
            {
                name: '絵文字除去テスト',
                input: 'こんにちは😊 今日はいい天気ですね🌞',
                expected: 'こんにちは 今日はいい天気ですね'
            },
            {
                name: '複合テスト（全要素含む）',
                input: 'こんにちは😊 *重要* https://example.com をチェック！🎉',
                expected: 'こんにちは 重要 をチェック！'
            },
            {
                name: 'アスタリスクのみ',
                input: '***',
                expected: ''
            },
            {
                name: 'URLのみ',
                input: 'https://www.example.com',
                expected: ''
            },
            {
                name: '正常なテキスト',
                input: 'これは普通のメッセージです。',
                expected: 'これは普通のメッセージです。'
            }
        ];

        // 自動テスト実行
        function runAutoTests() {
            const resultsDiv = document.getElementById('testResults');
            let html = '';
            let passedTests = 0;
            
            testCases.forEach((testCase, index) => {
                const result = removeEmojis(testCase.input);
                const passed = result === testCase.expected;
                
                if (passed) passedTests++;
                
                html += `
                    <div class="test-case ${passed ? 'passed' : 'failed'}">
                        <h4>${passed ? '✅' : '❌'} Test ${index + 1}: ${testCase.name}</h4>
                        <strong>入力:</strong> "${testCase.input}"<br>
                        <strong>期待:</strong> "${testCase.expected}"<br>
                        <strong>結果:</strong> "${result}"
                        ${!passed ? '<br><strong style="color:red;">❌ 期待値と一致しません</strong>' : ''}
                    </div>
                `;
            });
            
            html = `
                <div class="result">
                    <h3>🎯 テスト結果: ${passedTests}/${testCases.length} 通過</h3>
                    ${passedTests === testCases.length ? 
                        '<p style="color:green;">🎉 全てのテストが通過しました！</p>' : 
                        '<p style="color:red;">⚠️ 一部のテストが失敗しました。</p>'
                    }
                </div>
            ` + html;
            
            resultsDiv.innerHTML = html;
        }

        // 手動テスト
        function runManualTest() {
            const input = document.getElementById('manualTestInput').value;
            const result = removeEmojis(input);
            const resultDiv = document.getElementById('manualTestResult');
            
            resultDiv.innerHTML = `
                <h4>📋 フィルタリング結果</h4>
                <p><strong>元のテキスト:</strong> "${input}"</p>
                <p><strong>フィルタリング後:</strong> "${result}"</p>
                <p><strong>変更:</strong> ${input === result ? '変更なし' : '変更あり'}</p>
            `;
            resultDiv.style.display = 'block';
        }

        // 音声テスト
        function testSpeech() {
            const input = document.getElementById('speechTestInput').value;
            const cleanText = removeEmojis(input);
            const resultDiv = document.getElementById('speechTestResult');
            
            if (!cleanText || cleanText.length === 0) {
                resultDiv.innerHTML = `
                    <h4>🔇 音声読み上げスキップ</h4>
                    <p>フィルタリング後にテキストが空になったため、音声読み上げをスキップしました。</p>
                `;
            } else {
                resultDiv.innerHTML = `
                    <h4>🔊 音声読み上げテスト</h4>
                    <p><strong>元のテキスト:</strong> "${input}"</p>
                    <p><strong>読み上げテキスト:</strong> "${cleanText}"</p>
                `;
                
                // Web Speech API で音声読み上げ
                if ('speechSynthesis' in window) {
                    const utterance = new SpeechSynthesisUtterance(cleanText);
                    utterance.lang = 'ja-JP';
                    utterance.rate = 0.9;
                    utterance.pitch = 1.2;
                    utterance.volume = 0.8;
                    speechSynthesis.speak(utterance);
                    
                    resultDiv.innerHTML += '<p style="color:green;">✅ 音声読み上げを開始しました</p>';
                } else {
                    resultDiv.innerHTML += '<p style="color:red;">❌ このブラウザは音声読み上げに対応していません</p>';
                }
            }
            
            resultDiv.style.display = 'block';
        }

        // ページ読み込み時に自動テスト実行
        window.addEventListener('load', runAutoTests);
    </script>
</body>
</html>
